{% extends "base.html" %}

{% block title %}Scan Files - {{ scan.target }} - KAST Web{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-folder"></i> Scan Output Files</h2>
    <div>
        <a href="{{ url_for('scans.detail', scan_id=scan.id) }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Scan Details
        </a>
    </div>
</div>

<div class="card shadow mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-info-circle"></i> Directory Information</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <strong>Scan ID:</strong> {{ scan.id }}
            </div>
            <div class="col-md-6">
                <strong>Target:</strong> <code>{{ scan.target }}</code>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-12">
                <strong>Output Directory:</strong>
                <code class="d-block mt-1">{{ output_dir }}</code>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-md-6">
                <strong>Total Files:</strong> {{ files|length }}
            </div>
            <div class="col-md-6">
                <strong>Total Directories:</strong> {{ directories|length }}
            </div>
        </div>
    </div>
</div>

{% if directories %}
<div class="card shadow mb-4">
    <div class="card-header bg-secondary text-white">
        <h5 class="mb-0"><i class="bi bi-folder-fill"></i> Directories</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th><i class="bi bi-folder"></i> Name</th>
                        <th>Modified</th>
                    </tr>
                </thead>
                <tbody>
                    {% for dir in directories %}
                    <tr>
                        <td>
                            <i class="bi bi-folder-fill text-warning"></i>
                            <strong>{{ dir.name }}</strong>
                        </td>
                        <td>
                            <small>{{ dir.modified|int|timestamp_to_datetime }}</small>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% if files %}
<div class="card shadow">
    <div class="card-header bg-dark text-white">
        <h5 class="mb-0"><i class="bi bi-file-earmark"></i> Files</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th><i class="bi bi-file-earmark"></i> Name</th>
                        <th>Size</th>
                        <th>Modified</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in files %}
                    <tr>
                        <td>
                            {% if file.name.endswith('.json') %}
                                <i class="bi bi-filetype-json text-info"></i>
                            {% elif file.name.endswith('.html') %}
                                <i class="bi bi-filetype-html text-danger"></i>
                            {% elif file.name.endswith('.css') %}
                                <i class="bi bi-filetype-css text-primary"></i>
                            {% elif file.name.endswith('.txt') %}
                                <i class="bi bi-filetype-txt text-secondary"></i>
                            {% else %}
                                <i class="bi bi-file-earmark text-muted"></i>
                            {% endif %}
                            <a href="{{ url_for('scans.view_file', scan_id=scan.id, filename=file.name) }}" 
                               target="_blank" 
                               class="text-decoration-none">
                                <code>{{ file.name }}</code>
                            </a>
                        </td>
                        <td>
                            <span class="badge bg-light text-dark">{{ file.size|filesizeformat }}</span>
                        </td>
                        <td>
                            <small>{{ file.modified|int|timestamp_to_datetime }}</small>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% if not files and not directories %}
<div class="alert alert-info">
    <i class="bi bi-info-circle"></i> No files or directories found in the output directory.
</div>
{% endif %}
{% endblock %}
